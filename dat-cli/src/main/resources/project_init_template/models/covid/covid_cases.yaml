version: 1

semantic_models:
  - name: covid_cases
    description: 各国的covid病例。
    model: |
      -- 这是一个 MySQL 方言的示例查询SQL
      select
        CAST(STR_TO_DATE(date_rep, '%d/%m/%Y') AS DATE) as date_rep,
        cases,
        deaths,
        geo_id
      from covid_cases
      {% if start_date -%}
      where CAST(STR_TO_DATE(date_rep, '%d/%m/%Y') AS DATE) > '{{ start_date }}'
      {% endif %}
      /*
      -- 这是一个 DuckDB 方言的示例查询SQL
      select
        CAST(strptime(date_rep, '%d/%m/%Y') AS DATE) as date_rep,
        cases,
        deaths,
        geo_id
      from covid_cases
      {% if start_date -%}
      where CAST(strptime(date_rep, '%d/%m/%Y') AS DATE) > '{{ start_date }}'
      {% endif %}
      */
    defaults:
      agg_time_dimension: report_date
    entities:
      - name: country_id
        description: 国家代码
        expr: geo_id
        type: primary
    dimensions:
      - name: report_date
        description: 报告日期
        expr: date_rep
        type: time
        type_params:
          time_granularity: day
    measures:
      - name: cases
        description: 病历数
      - name: deaths
        description: 死亡数
      - name: cases_total
        description: 病历总数
        agg: sum
        expr: cases
      - name: deaths_total
        description: 死亡总数
        agg: sum
        expr: deaths
